SetCompress force
SetCompressor ZLIB

Unicode true
!include MUI2.nsh
!include x64.nsh
!include servicelib.nsh

RequestExecutionLevel admin
!define MUI_LANGDLL_ALLLANGUAGES

OutFile "galaxy42_installer.exe"
Name "galaxy42"
InstallDir $PROGRAMFILES\galaxy42

# Set up page order
!insertmacro MUI_PAGE_WELCOME
### MessageBox MB_OK "[EN] This program is not yet ready nor secure, do not use it in this version. [PL] Ten program nie jest jeszcze gotowy i nie jest bezpieczny, nie u≈ºywaj go w tej wersji." # TODO
!insertmacro MUI_PAGE_LICENSE ..\..\LICENCE.gpl3.txt
!insertmacro MUI_PAGE_DIRECTORY
!insertmacro MUI_PAGE_INSTFILES
!insertmacro MUI_PAGE_FINISH

!insertmacro MUI_UNPAGE_WELCOME
!insertmacro MUI_UNPAGE_CONFIRM
!insertmacro MUI_UNPAGE_INSTFILES
!insertmacro MUI_UNPAGE_FINISH

!insertmacro MUI_LANGUAGE "English" ;first language is the default language
!insertmacro MUI_LANGUAGE "Afrikaans"
!insertmacro MUI_LANGUAGE "Albanian"
!insertmacro MUI_LANGUAGE "Arabic"
!insertmacro MUI_LANGUAGE "Basque"
!insertmacro MUI_LANGUAGE "Belarusian"
!insertmacro MUI_LANGUAGE "Bosnian"
!insertmacro MUI_LANGUAGE "Breton"
!insertmacro MUI_LANGUAGE "Bulgarian"
!insertmacro MUI_LANGUAGE "Catalan"
!insertmacro MUI_LANGUAGE "Croatian"
!insertmacro MUI_LANGUAGE "Czech"
!insertmacro MUI_LANGUAGE "Danish"
!insertmacro MUI_LANGUAGE "Dutch"
!insertmacro MUI_LANGUAGE "Esperanto"
!insertmacro MUI_LANGUAGE "Estonian"
!insertmacro MUI_LANGUAGE "Farsi"
!insertmacro MUI_LANGUAGE "Finnish"
!insertmacro MUI_LANGUAGE "French"
!insertmacro MUI_LANGUAGE "Galician"
!insertmacro MUI_LANGUAGE "German"
!insertmacro MUI_LANGUAGE "Greek"
!insertmacro MUI_LANGUAGE "Hebrew"
!insertmacro MUI_LANGUAGE "Hungarian"
!insertmacro MUI_LANGUAGE "Icelandic"
!insertmacro MUI_LANGUAGE "Indonesian"
!insertmacro MUI_LANGUAGE "Irish"
!insertmacro MUI_LANGUAGE "Italian"
!insertmacro MUI_LANGUAGE "Japanese"
!insertmacro MUI_LANGUAGE "Korean"
!insertmacro MUI_LANGUAGE "Kurdish"
!insertmacro MUI_LANGUAGE "Latvian"
!insertmacro MUI_LANGUAGE "Lithuanian"
!insertmacro MUI_LANGUAGE "Luxembourgish"
!insertmacro MUI_LANGUAGE "Macedonian"
!insertmacro MUI_LANGUAGE "Malay"
!insertmacro MUI_LANGUAGE "Mongolian"
!insertmacro MUI_LANGUAGE "Norwegian"
!insertmacro MUI_LANGUAGE "NorwegianNynorsk"
!insertmacro MUI_LANGUAGE "Polish"
!insertmacro MUI_LANGUAGE "Portuguese"
!insertmacro MUI_LANGUAGE "PortugueseBR"
!insertmacro MUI_LANGUAGE "Romanian"
!insertmacro MUI_LANGUAGE "Russian"
!insertmacro MUI_LANGUAGE "Serbian"
!insertmacro MUI_LANGUAGE "SerbianLatin"
!insertmacro MUI_LANGUAGE "SimpChinese"
!insertmacro MUI_LANGUAGE "Slovak"
!insertmacro MUI_LANGUAGE "Slovenian"
!insertmacro MUI_LANGUAGE "Spanish"
!insertmacro MUI_LANGUAGE "SpanishInternational"
!insertmacro MUI_LANGUAGE "Swedish"
!insertmacro MUI_LANGUAGE "Thai"
!insertmacro MUI_LANGUAGE "TradChinese"
!insertmacro MUI_LANGUAGE "Turkish"
!insertmacro MUI_LANGUAGE "Ukrainian"
!insertmacro MUI_LANGUAGE "Uzbek"
!insertmacro MUI_LANGUAGE "Welsh"

Section "Install openvpn"
       SetOutPath "$INSTDIR\share"
       File "bin/noarch/openvpn-install-2.4.4-I601.exe"
       ExecWait "$INSTDIR\share\openvpn-install-2.4.4-I601.exe"
       Delete "$INSTDIR\share\openvpn-install-2.4.4-I601.exe"
SectionEnd

Section
	SetShellVarContext all
	SetOutPath $INSTDIR
	WriteUninstaller $INSTDIR\uninstall.exe

	# START_FILES  --- list of files is generate automatic with generate_nsis_filelist.sh script -- do not add new files here manualy

	# END_FILES

	!insertmacro SERVICE create "galaxy" "path=$INSTDIR\galaxyService.exe;autostart=1;interact=1;display=galaxy42;description=galaxy42 node;"
	!insertmacro SERVICE start "galaxy" ""
SectionEnd

Section "Uninstall"
	SetShellVarContext all
	!insertmacro SERVICE stop "galaxy" ""
	sleep 3000 # wait for service
	!insertmacro SERVICE delete "galaxy" ""
	RMDir /r $INSTDIR
SectionEnd

Function .onInit
	!insertmacro MUI_LANGDLL_DISPLAY
FunctionEnd
